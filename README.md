
<div dir="rtl" align="right">

# زنجیر - پیام‌رسان امن و غیرمتمرکز بر پایه Matrix

<div align="center">

![زنجیر](https://img.shields.io/badge/زنجیر-v1.0.0-blue?style=for-the-badge)
![Matrix](https://img.shields.io/badge/Matrix-Protocol-green?style=for-the-badge)
![License](https://img.shields.io/badge/License-Apache%202.0-orange?style=for-the-badge)

**یک راه‌حل آماده نصب برای راه‌اندازی سرور Matrix شخصی با رابط کاربری فارسی**

</div>

---

## معرفی

زنجیر در واقع یک کانفیگ آماده و بسته‌بندی شده از پروتکل Matrix هست که کار رو راحت کرده. هدف اینه که بتونید سرور پیام‌رسان شخصی خودتون رو زیر ۵ دقیقه بالا بیارید، بدون اینکه درگیر کانفیگ‌های پیچیده بشید.

### ویژگی‌ها

- **کاملاً فارسی** - رابط کاربری ۱۰۰٪ فارسی و راست‌چین شده است.
- **رمزنگاری سرتاسری** - تمام پیام‌ها به صورت پیش‌فرض رمزنگاری (E2E) می‌شوند.
- **سبک و سریع** - بک‌اند روی Dendrite سوار شده، پس روی VPSهای ارزون و کم‌منابع هم خوب کار میکنه.
- **نصب آسان** - کل پروسه با یک اسکریپت انجام میشه.
- **چندپلتفرمی** - کلاینت وب، موبایل و دسکتاپ داره.
- **غیرمتمرکز** - دیتا دست خودتونه و به سرور مرکزی وابستگی ندارید.
- **SSL خودکار** - گواهی HTTPS رو خودکار از Let's Encrypt میگیره.

---

## پیش‌نیازها

### سخت‌افزار
برای شروع یه سرور خیلی معمولی هم کافیه:

| منبع | حداقل | پیشنهادی |
|------|-------|----------|
| CPU | 1 هسته | 2 هسته |
| RAM | 1 گیگابایت | 2 گیگابایت |
| فضای دیسک | 10 گیگابایت | 20 گیگابایت |

### نرم‌افزار
- سیستم عامل: **Ubuntu 22.04 LTS** یا **Ubuntu 24.04 LTS**
- یک دامنه که A Record اون به IP سرور شما وصل شده باشه.
- دسترسی root به سرور.

---

## راهنمای نصب

### گام ۱: دریافت پروژه

```bash
git clone [https://github.com/MatinSenPai/zanjir.git](https://github.com/MatinSenPai/zanjir.git)
cd zanjir

```

### گام ۲: چک کردن دامنه و پورت‌ها

قبل از اجرا، مطمئن بشید DNS ست شده و پورت‌های وب باز هستن:

1. رکورد A دامنه باید به IP سرور اشاره کنه.
2. پورت‌های 80 و 443 باید باز باشن.

```bash
# بررسی DNS 
dig +short yourdomain.com

# باز کردن پورت‌ها در UFW (اگر فایروال دارید)
sudo ufw allow 80
sudo ufw allow 443

```

### گام ۳: اجرای اسکریپت نصب

```bash
chmod +x install.sh
sudo ./install.sh yourdomain.com

```

نکته: جای `yourdomain.com` دامین خودتون رو بزنید.

### گام ۴: اتمام نصب

اسکریپت خودش کارهای زیر رو انجام میده:

* نصب Docker و Docker Compose (اگه نباشه).
* ساخت کلیدهای امنیتی (Signing Keys).
* بالا آوردن سرویس‌ها.
* گرفتن SSL.

---

## ساخت کاربر (User)

ثبت‌نام عمومی رو بستم که سرورتون اسپم نشه. برای ساخت یوزر جدید باید دستور زیر رو توی ترمینال سرور بزنید:

```bash
docker exec -it zanjir-dendrite /usr/bin/create-account \
    --config /etc/dendrite/dendrite.yaml \
    --username نام_کاربری \
    --admin

```

بعدش ازتون پسورد میخواد که وارد می‌کنید.

---

## نحوه استفاده

### ورود از وب

1. مرورگر رو باز کنید و برید به `https://yourdomain.com`.
2. دکمه "ورود" رو بزنید و با یوزری که ساختید لاگین کنید.

### ورود از موبایل

1. اپلیکیشن Element رو نصب کنید (Google Play یا App Store).
2. گزینه "ورود" رو بزنید.
3. حتماً دکمه "ویرایش" (Edit) کنار آدرس سرور رو بزنید و آدرس سرور خودتون (`https://yourdomain.com`) رو وارد کنید.
4. لاگین کنید.

### ساخت اتاق جدید

1. دکمه + پایین صفحه.
2. گزینه "اتاق جدید".
3. تعیین نام و تنظیمات پرایوسی (خصوصی/عمومی).

### فعال‌سازی رمزنگاری

چت‌های دایرکت (PV) پیش‌فرض رمزنگاری شده‌ست. برای گروه‌ها:
تنظیمات اتاق -> امنیت و حریم خصوصی -> فعال‌سازی رمزنگاری.

---

## دستورات کاربردی

مدیریت سرویس‌ها با Docker Compose انجام میشه:

```bash
# وضعیت کانتینرها
docker compose ps

# دیدن لاگ‌ها (برای دیباگ)
docker compose logs -f

# ریستارت سرویس‌ها
docker compose restart

# خاموش کردن کامل
docker compose down

# آپدیت کردن
docker compose pull
docker compose up -d

```

---

## حل مشکلات رایج

### گواهی SSL صادر نمی‌شود

احتمال زیاد مشکل DNS دارید.

* دستور `dig +short yourdomain.com` رو بزنید. باید IP سرور رو بده.
* اگر تازه دامین رو ست کردید، ممکنه طول بکشه.
* کانتینر Caddy رو ریستارت کنید: `docker compose restart caddy`.

### صفحه لود نمی‌شود

فایروال رو چک کنید. پورت 80 و 443 باید باز باشه.

```bash
sudo ufw allow 80
sudo ufw allow 443
sudo ufw reload

```

### خطای لاگین (User not found)

یوزر رو نساختید. بخش "ساخت کاربر" رو بخونید.

### سرعت پایین یا قطعی

اگر سرور ایرانه، ممکنه اختلال اینترنت باشه.

* راهکار: استفاده از CDN (مثل ابرآروان) یا تانل کردن.

### خطای Federation

پورت 8448 برای ارتباط با سایر سرورهای ماتریکس (Federation) استفاده میشه. اگر لازمش ندارید، توی فایل `dendrite/dendrite.yaml` غیرفعالش کنید:

```yaml
global:
  disable_federation: true

```

---

## ساختار فایل‌ها

```
zanjir/
├── install.sh              # اسکریپت نصب اصلی
├── docker-compose.yml      # ارکستراسیون داکر
├── Caddyfile               # کانفیگ وب‌سرور و SSL
├── .env.example            # نمونه متغیرها
├── config/
│   ├── element-config.json # کانفیگ کلاینت وب (Element)
│   └── welcome.html        # صفحه لندینگ
├── dendrite/
│   └── dendrite.yaml       # کانفیگ اصلی سرور ماتریکس
└── scripts/
    └── generate-keys.sh    # اسکریپت تولید کلیدها

```

---

## امنیت و بکاپ

### نکات امنیتی

* پسورد قوی بذارید.
* فایل `.env` رو جایی منتشر نکنید (کلیدهای خصوصی توشه).
* سرور اوبونتو رو آپدیت نگه دارید.

### بکاپ‌گیری

دیتابیس و فایل‌های کانفیگ مهم‌ترین بخش‌ها هستن.

```bash
# دامپ گرفتن از دیتابیس
docker exec zanjir-postgres pg_dump -U dendrite dendrite > backup.sql

# آرشیو کردن کل پوشه دیتا و کانفیگ
tar -czvf zanjir-backup.tar.gz dendrite/ config/ .env

```

---

## لایسنس

این پروژه تحت لایسنس Apache 2.0 منتشر شده.

---

## کردیت‌ها

این پروژه بر پایه ابزارهای اوپن‌سورس زیر ساخته شده:

* [Matrix.org](https://matrix.org)
* [Dendrite](https://github.com/matrix-org/dendrite)
* [Element](https://element.io)
* [Caddy](https://caddyserver.com)

---

## پشتیبانی

مشکلی دیدید توی بخش Issues گیت‌هاب مطرح کنید.

<div align="center">

**تقدیم به بچه‌های خوب ایران=)**

</div>

</div>

```